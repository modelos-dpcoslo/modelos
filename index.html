<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de ofício - BANCOS</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="geradorestilo.css" />
</head>
<body>
    
    <img src="icones/logpcsc.png" alt="pcsc" width="95px" height="115px" class="pcsc">

    <div id="cabecalho"> 
        POLÍCIA CIVIL DO ESTADO DE SANTA CATARINA
        <br>DPCO/FRON DE SÃO LOURENÇO DO OESTE
        <br>
    </div>
    <div id="titulo">
        <img src="icones/bank.png" alt="bank" width="85px" height="85px">
    GERADOR DE OFÍCIO - BANCOS</div>
               
    <div>
        <h1>Insira os dados do ofício:</h1>
        <input type="number" id="inpoficio" title="DIGITE O NÚMERO DO OFÍCIO"> / ANO / 
            <select name="policial" id="policial">
                <option value="gab">GAB</option>
                <option value="avar">AVAR</option>
                <option value="vls">VLS</option>
                <option value="svp">SVP</option>
                <option value="dbn">DBN</option>
                <option value="am">AM</option>
            </select> / DPCO-SLO
        <br>Procedimento de origem: <input type="text" id="inporigem" value="Boletim de Ocorrência xxx.2023.xxxxx" title="BO / IP / APF"> 
    </div>
    <div>
        <h1>Insira os dados do alvo:</h1>
        NOME: 
        <br><input type="text" id="inpnalvo" value="Fulano de Tal">
        <br>CPF/CNPJ:
        <br><input type="text" id="inpcpfalvo" pattern="\d{3}\.?\d{3}-?\d{2}|\d{2}\.?\d{3}\.?\d{3}/?\d{4}-?\d{2}" title="CPF: xxx.xxx.xxx-xx \ CNPJ: xx.xxx.xxx/xxxx-xx" value="xxx.xxx.xxx-xx">
    </div>  
    <div>
        <h1>Escolha o banco destinatário:</h1>
        <select id="inpbanco">
            <option value="acesso" selected>Acesso Soluções S.A.</option>
            <option value="pan">Banco Pan</option>
            <option value="bradesco">Bradesco</option>
            <option value="c6bank">C6 Bank</option>
            <option value="dock">Dock Soluções</option>
            <option value="itau">Itaú</option>
            <option value="mercadopago">Mercado Pago.com Ltda.</option>
            <option value="n26">N26 Tecnologia S.dePag. Ltda.</option>
            <option value="pagseguro">Pagseguro Internet S/A</option>
            <option value="picpay">PicPay Instituição de Pag. S/A</option>
            <option value="santander">Santander</option>
        </select><br>
        
    </div>
    <button onclick="generate()">GERAR OFÍCIO</button>
    
</body>
<!-- inicio de carregamento dos script necessários para abri modelo .DOCX e salvar resultado-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.11/docxtemplater.js"></script>
<script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
<script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip-utils.js"></script>
<!-- fim de carregamento dos scripts necessários-->

<script>
    /* 
    INCIO DO SCRIPT para obter a DATA ATUAL e transformar em formato oficial.
    */
    function obterNomeMes(numeroMes) {
        // Array com os nomes dos meses (janeiro é o índice 0)
        var nomesMeses = [
            'janeiro', 'fevereiro', 'março', 'abril', 'maio', 'junho',
            'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
        ];

        return nomesMeses[numeroMes - 1];
    }

    function obterData() {
        var data = new Date();

        // Obtenha os componentes da data
        var dia = data.getDate();
        var mes = data.getMonth() + 1; // Os meses são indexados a partir de zero, então é necessário adicionar 1
        ano = data.getFullYear();  // retirado o var para que a variável tenha escopo GLOBAL

        // Montar a representação da data no padrão desejado (exemplo: DD de MMMM de AAAA)
        var valdatareq = dia + ' de ' + obterNomeMes(mes) + ' de ' + ano + '.';

        // Exiba a representação da data
        return valdatareq;
    }
    /* 
    FIM DO SCRIPT para obter a DATA ATUAL e transformar em formato oficial.
    */
    /* INICIO DO SCRIPT para configurar abreviatura e e-mail do policial*/
    function nomePolicial() {
        const elpolicial = document.querySelector('#policial')
        const valpolicial = elpolicial.value
        switch (valpolicial) {
            case 'avar':
                varsiglapolicial = 'AVAR';
                varemailpolicial = '"andre-avanci@pc.sc.gov.br" e '
                break;
            case 'gab':
                varsiglapolicial = 'GAB';
                varemailpolicial = ''
                break;
            case 'vls':
                varsiglapolicial = 'VLS';
                varemailpolicial = '"vander-stang@pc.sc.gov.br" e '
                break;
            case 'svp':
                varsiglapolicial = 'SVP';
                varemailpolicial = '"sidney-palavezzini@pc.sc.gov.br" e '
                break;
            case 'dbn':
                varsiglapolicial = 'DBN';
                varemailpolicial = '"dimas-netto@pc.sc.gov.br" e '
                break;
            case 'am':
                varsiglapolicial = 'AM';
                varemailpolicial = '"almir-matte@pc.sc.gov.br" e '
                break;       
        } 

    }
    /* FIM DO SCRIPT para configurar abreviatura e e-mail do policial*/

    /* INICIO DO SCRIPT para configurar BANCO destinatário conforme a opção do banco selecionado*/
    function nomeBanco() {
        const elbanco = document.querySelector('#inpbanco')
        const valbanco = elbanco.value
        switch (valbanco) {
            case 'acesso':
                return "ACESSO SOLUCOES DE PAGAMENTO S.A. INSTITUCAO DE PAGAMENTO\nCNPJ - 13.140.088/0001-99\n(e-mail)";
                break;
            case 'pan':
                return "BANCO PAN S.A.\nCNPJ 59.285.411/0001-13\noficios.legal@grupopan.com";
                break;
            case 'bradesco':
                return "DEPARTAMENTO JURÍDICO\nBANCO BRADESCO S.A.\nCNPJ 60.746.948/0001-12\noficiosjudiciais@bradesco.com.br";
                break;
            case 'c6bank':
                return "C6 BANK\nCNPJ 31.872.495/0001-72\noficiosbacen@c6bank.com.br";
                break;
            case 'dock':
                return "BANCO DOCK SOLUÇÕES\nDOCK INSTITUICAO DE PAGAMENTO S.A.\nCNPJ 13.370.835/0001-85\ncontato@dock.tech";
                break;
            case 'itau':
                return "ITAÚ UNIBANCO\nGERÊNCIA DE OFÍCIOS E SIST. MOVIMENTAÇÃO BANCÁRIA\nCNPJ 60.701.190/0001-04\nitaujudicial@itau-unibanco.com.br";
                break;
            case 'mercadopago':
                return "MERCADOPAGO.COM INSTITUIÇÃO DE PAGAMENTO LTDA.\nCNPJ: 10.573.521/0001-91\noficios@mercadolivre.com";
                break;
            case 'n26':
                return "N26 TECNOLOGIA E SOLUCOES DE PAGAMENTO LTDA.\nCNPJ - 33.781.963/0001-29\nlegal@n26brasil.com";
                break;
            case 'pagseguro':
                return "PAGSEGURO INTERNET S/A\nCNPJ: 08.561.701/0001-01\nintimauol@uolinc.com";
                break;
            case 'picpay':
                return "PICPAY INSTITUIÇÃO DE PAGAMENTO S/A\nCNPJ: 22.896.431/0001-10\njuridico@picpay.com";
                break;
            case 'santander':
                return "Banco Santander";
                break;
            default:
                console.log("*****  informar banco destinatário manualmente  *****");
            }
    }
    /* FIM DO SCRIPT para configurar BANCO destinatário conforme a opção do banco selecionado*/      
    /* 
    INCIO DO SCRIPT para GERAR DOCUMENTO COM DOXTEMPLATER-BROWSER.
    */
    function loadFile(url, callback) {
        PizZipUtils.getBinaryContent(url, callback);
    }
    window.generate = function generate() {
        loadFile(
            "modelos/modeloofbanco.docx",
            function (error, content) {
                if (error) {
                    throw error;
                }
                const zip = new PizZip(content);
                const doc = new window.docxtemplater(zip, {
                    paragraphLoop: true,
                    linebreaks: true,
                });


                // Capturar número do OFÍCIO
                let eloficio = document.querySelector('#inpoficio')
                let valoficio = eloficio.value
                
                // Capturar nome do BANCO   
                let valbanco = nomeBanco();

                // Capturar nome e e-mail do policial   (variáveis GLOBAIS criadas na própria função)
                nomePolicial();
                
                // Capturar procedimento de Origem BO/IP
                let elorigem = document.querySelector('#inporigem')
                let valorigem = elorigem.value
              
                // Gerar DATA atual
                let valdatareq = obterData();

                // Capturar nome do alvo
                let elnalvo = document.querySelector('#inpnalvo')
                let valnalvo = elnalvo.value

                // Capturar CPF do alvo
                let elcpfalvo = document.querySelector('#inpcpfalvo')
                let valcpfalvo = elcpfalvo.value
                
                // RENDERIZAR O DOCUMENTO (Troca {insoficio} do modelo .docx pelo valor de valoficio, e assim por diante ...)
                doc.render({
                    insoficio: valoficio,
                    insano: ano,
                    inspolicial: varsiglapolicial,
                    insdata: valdatareq,
                    inscliente: valnalvo,
                    inscpf: valcpfalvo,
                    insemail: varemailpolicial,
                    insbanco: valbanco,
                    insorigem: valorigem,                   
                });

                const blob = doc.getZip().generate({
                    type: "blob",
                    mimeType:
                        "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                    // compression: DEFLATE adds a compression step.
                    // For a 50MB output document, expect 500ms additional CPU time
                    compression: "DEFLATE",
                });
                // Output the document using Data-URI
                let nomefinal = 'Oficio-' + valoficio + '-' + ano + '-' + valbanco.split(' ')[0];
                saveAs(blob, nomefinal + "_.docx");
                window.alert('Ofício gerado! Confira os DADOS antes de ENVIAR AO BANCO !')
            }
        );
    };
     /* 
    FIM DO SCRIPT para GERAR DOCUMENTO COM DOXTEMPLATER-BROWSER.
    */
</script>
</html>